<!doctype html>
<html lang="pt-BR" class="dark" style="font-size: 16px;">
<head>
    <link rel="icon" href="https://zeus-rr.github.io/treino/icon.png">
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title id="pageTitle">SISTEMA DE TREINO</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class', 
            theme: { extend: { colors: { 'pink-hot': 'var(--main-color, #FF1493)', 'bg-dark': '#0b0f1a' } } }
        }
    </script>
    <style>
        :root { --main-color: #FF1493; }
        body { font-size: 1rem; transition: background 0.3s, color 0.3s; }
        .dynamic-text { font-size: 1.8rem !important; }
        .dynamic-sub { font-size: 0.9rem !important; }
        .is-conjugated { margin-bottom: -1rem !important; border-bottom-left-radius: 0 !important; border-bottom-right-radius: 0 !important; border-bottom: 2px dashed var(--main-color) !important; z-index: 10; }
        .is-student-mode .admin-ui { display: none !important; }
        .custom-scrollbar::-webkit-scrollbar { width: 4px; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: var(--main-color); border-radius: 10px; }
        details summary::-webkit-details-marker { display: none; }
    </style>
</head>
<body class="bg-slate-50 dark:bg-bg-dark text-slate-900 dark:text-slate-100 font-sans min-h-screen">

    <main class="max-w-7xl mx-auto p-4 lg:p-8 grid grid-cols-1 lg:grid-cols-12 gap-8">
        
        <aside class="lg:col-span-4 space-y-6 admin-ui">
            <div class="bg-white dark:bg-slate-900 p-6 rounded-[2.5rem] shadow-xl border border-slate-100 dark:border-slate-800 text-center">
                <img id="profPhotoDisplay" src="" class="w-24 h-24 rounded-full mx-auto mb-4 border-4 border-pink-hot object-cover">
                <h2 id="profNameDisplay" class="font-black italic uppercase text-lg pink-hot leading-tight">PROFESSOR</h2>
            </div>

            <div class="bg-white dark:bg-slate-900 p-6 rounded-[2.5rem] shadow-xl border border-slate-100 dark:border-slate-800 space-y-4">
                <h3 class="text-[10px] font-black uppercase text-pink-hot tracking-widest text-center italic">Dados do Aluno</h3>
                <input type="text" id="studentName" placeholder="Nome do Aluno" oninput="updateUI()" class="w-full bg-slate-100 dark:bg-slate-800 p-3 rounded-xl outline-none font-bold uppercase text-xs">
                <input type="url" id="studentPhoto" placeholder="URL da Foto do Aluno" oninput="updateUI()" class="w-full bg-slate-100 dark:bg-slate-800 p-3 rounded-xl outline-none text-[10px]">
                <textarea id="generalNotes" placeholder="ObservaÃ§Ãµes" oninput="updateUI()" class="w-full bg-slate-100 dark:bg-slate-800 p-3 rounded-xl outline-none h-20 text-xs"></textarea>
                
                <div class="grid grid-cols-2 gap-2">
                    <button onclick="saveToHistory()" class="bg-pink-hot text-white py-4 rounded-2xl font-black text-[10px] uppercase shadow-lg">Salvar</button>
                    <button onclick="copyStudentLink()" class="bg-slate-800 text-white py-4 rounded-2xl font-black text-[10px] uppercase">Gerar Link</button>
                </div>
            </div>
            <div id="historyList" class="space-y-2 max-h-[150px] overflow-y-auto custom-scrollbar"></div>
            <div id="libContainer" class="space-y-2"></div> 
        </aside>

        <section class="lg:col-span-8 space-y-6">
            <div class="flex justify-end items-center gap-3 mb-4">
                <div class="flex bg-white dark:bg-slate-800 rounded-xl p-1 shadow-sm border border-slate-200 dark:border-slate-700">
                    <button onclick="changeFontSize(-2)" class="px-4 py-2 hover:bg-slate-100 dark:hover:bg-slate-700 rounded-lg font-black text-sm">A-</button>
                    <button onclick="changeFontSize(2)" class="px-4 py-2 hover:bg-slate-100 dark:hover:bg-slate-700 rounded-lg font-black text-lg">A+</button>
                </div>
                <button onclick="toggleTheme()" class="p-3 bg-white dark:bg-slate-800 rounded-xl shadow border border-slate-200 dark:border-slate-700 text-xl">ðŸŒ“</button>
            </div>

            <header class="flex items-center gap-4 mb-8">
                <div class="relative">
                    <img id="displayStudentPhoto" src="https://zeus-rr.github.io/treino/icon.png" class="w-24 h-24 rounded-full border-2 border-pink-hot object-cover">
                    <img id="headerProfPhoto" src="" class="w-10 h-10 rounded-full border-2 border-slate-900 absolute -bottom-1 -right-1 object-cover">
                </div>
                <div>
                    <h4 id="displayStudent" class="font-black italic uppercase pink-bold leading-none dynamic-text">NOVO ALUNO</h4>
                    <p id="displayProf" class="font-bold opacity-40 uppercase dynamic-sub"></p>
                </div>
            </header>
            <div id="workoutGrid" class="grid grid-cols-1 md:grid-cols-2 gap-6"></div>
        </section>
    </main>

    <script>
        let currentStaff = null; let baseFontSize = 16;
        let workoutData = {
            student: "", studentPhoto: "", generalNotes: "", photoProf: "", profName: "", themeColor: "#FF1493",
            days: { segunda: [], terca: [], quarta: [], quinta: [], sexta: [], sabado: [] }
        };

        const library = { "Peito": ["Supino Reto", "Supino Inclinado", "Crucifixo", "Peck Deck"], "Costas": ["Puxada Frente", "Remada Curvada", "Pulldown"], "Pernas": ["Agachamento", "Leg Press", "Extensora"], "BraÃ§os": ["Rosca Direta", "TrÃ­ceps Corda"] };

        function changeFontSize(d) { baseFontSize += d; document.documentElement.style.fontSize = baseFontSize + 'px'; }
        function toggleTheme() { document.documentElement.classList.toggle('dark'); }

        function updateUI() {
            workoutData.student = document.getElementById('studentName').value;
            workoutData.studentPhoto = document.getElementById('studentPhoto').value;
            workoutData.generalNotes = document.getElementById('generalNotes').value;
            document.getElementById('displayStudent').innerText = workoutData.student || "NOVO ALUNO";
            document.getElementById('displayStudentPhoto').src = workoutData.studentPhoto || "https://zeus-rr.github.io/treino/icon.png";
            document.getElementById('displayProf').innerText = "Personal: " + (workoutData.profName || "");
            document.getElementById('profNameDisplay').innerText = workoutData.profName || "PROFESSOR";
            document.getElementById('profPhotoDisplay').src = workoutData.photoProf || "";
            document.getElementById('headerProfPhoto').src = workoutData.photoProf || "";
            document.documentElement.style.setProperty('--main-color', workoutData.themeColor);
        }

        function copyStudentLink() {
            updateUI();
            if (!workoutData.student) return alert("Digite o nome!");
            const dataStr = btoa(encodeURIComponent(JSON.stringify(workoutData)));
            const url = `${window.location.origin}${window.location.pathname}?aluno=${dataStr}`;
            navigator.clipboard.writeText(url).then(() => alert("Link Copiado com Nome e Foto!"));
        }

        function init() {
            const params = new URLSearchParams(window.location.search);
            const aluno = params.get('aluno');
            const auth = params.get('auth');
            if (aluno) {
                document.body.classList.add('is-student-mode');
                workoutData = JSON.parse(decodeURIComponent(atob(aluno)));
            } else if (auth) {
                const data = JSON.parse(atob(auth));
                const staff = JSON.parse(localStorage.getItem('staff_data')) || [];
                currentStaff = staff.find(p => p.id === data.id && p.pass === data.pw);
                if (currentStaff) {
                    workoutData.profName = currentStaff.name;
                    workoutData.photoProf = currentStaff.photo;
                    workoutData.themeColor = currentStaff.color;
                }
            }
            render(); renderLibrary(); renderHistory(); updateUI();
        }

        function render() {
            const grid = document.getElementById('workoutGrid'); grid.innerHTML = "";
            Object.keys(workoutData.days).forEach(day => {
                const dayDiv = document.createElement('div');
                dayDiv.className = "bg-white dark:bg-slate-900 p-6 rounded-[2.5rem] shadow-lg border border-slate-100 dark:border-slate-800";
                dayDiv.innerHTML = `<h3 class="font-black italic uppercase mb-4 pink-bold border-b border-pink-hot/10 pb-2">${day}</h3><div id="list-${day}" class="space-y-3 min-h-[50px]"></div>`;
                grid.appendChild(dayDiv); renderDayItems(day);
            });
        }

        function renderDayItems(day) {
            const container = document.getElementById(`list-${day}`);
            container.innerHTML = (workoutData.days[day] || []).map((ex, idx) => `
                <div class="p-4 bg-slate-50 dark:bg-slate-800 rounded-2xl ${ex.conj ? 'is-conjugated' : ''}">
                    <div class="flex justify-between items-center mb-2">
                        <span class="font-black uppercase pink-hot dynamic-sub">${ex.name}</span>
                        <div class="admin-ui flex gap-2"><button onclick="toggleConj('${day}',${idx})">ðŸ”—</button><button onclick="removeItem('${day}',${idx})">âœ•</button></div>
                    </div>
                    <div class="grid grid-cols-2 gap-2">
                        <input type="text" placeholder="Sets" value="${ex.sets||''}" onchange="workoutData.days['${day}'][${idx}].sets=this.value" class="bg-white dark:bg-slate-700 p-2 rounded-lg text-xs font-bold">
                        <input type="text" placeholder="Carga" value="${ex.load||''}" onchange="workoutData.days['${day}'][${idx}].load=this.value" class="bg-white dark:bg-slate-700 p-2 rounded-lg text-xs font-bold">
                    </div>
                </div>
            `).join('');
        }

        function addItem(day, name) { workoutData.days[day].push({ name, sets: "", load: "", conj: false }); renderDayItems(day); }
        function removeItem(day, idx) { workoutData.days[day].splice(idx, 1); renderDayItems(day); }
        function toggleConj(day, idx) { workoutData.days[day][idx].conj = !workoutData.days[day][idx].conj; renderDayItems(day); }

        function renderLibrary() {
            const container = document.getElementById('libContainer');
            container.innerHTML = `<div class="bg-white dark:bg-slate-900 p-6 rounded-[2.5rem] border border-slate-800 shadow-xl"><h3 class="text-[10px] font-black uppercase mb-4 text-pink-hot text-center italic">Biblioteca</h3><div class="space-y-2">${Object.keys(library).map(cat => `<details class="group"><summary class="list-none p-3 bg-slate-800 rounded-xl cursor-pointer font-bold text-[9px] uppercase flex justify-between items-center group-open:bg-pink-hot transition-all">${cat} <span>+</span></summary><div class="p-2 space-y-1">${library[cat].map(ex => `<div class="flex justify-between items-center p-2 hover:bg-slate-700 rounded-lg"><span class="text-[8px] font-bold uppercase opacity-70">${ex}</span><select onchange="if(this.value) addItem(this.value, '${ex}'); this.value='';" class="bg-pink-hot text-white text-[8px] rounded px-1 outline-none"><option value="">+</option><option value="segunda">SEG</option><option value="terca">TER</option><option value="quarta">QUA</option><option value="quinta">QUI</option><option value="sexta">SEX</option><option value="sabado">SAB</option></select></div>`).join('')}</div></details>`).join('')}</div></div>`;
        }

        function renderHistory() {
            if(!currentStaff) return;
            const history = JSON.parse(localStorage.getItem(`history_${currentStaff.id}`)) || {};
            const container = document.getElementById('historyList');
            container.innerHTML = Object.keys(history).map(name => `<div class="flex items-center justify-between p-2 bg-slate-800 rounded-xl mb-1"><span class="text-[9px] font-bold uppercase truncate max-w-[100px] px-2 text-white">${name}</span><button onclick="loadStudent('${name}')" class="bg-pink-hot text-white text-[8px] px-3 py-1 rounded-full uppercase font-black">Abrir</button></div>`).join('');
        }

        function loadStudent(name) {
            const history = JSON.parse(localStorage.getItem(`history_${currentStaff.id}`));
            workoutData = JSON.parse(JSON.stringify(history[name]));
            document.getElementById('studentName').value = workoutData.student;
            document.getElementById('studentPhoto').value = workoutData.studentPhoto || "";
            document.getElementById('generalNotes').value = workoutData.generalNotes || "";
            render(); updateUI();
        }

        function saveToHistory() {
            if(!currentStaff || !workoutData.student) return alert("Erro");
            updateUI();
            let history = JSON.parse(localStorage.getItem(`history_${currentStaff.id}`)) || {};
            history[workoutData.student] = JSON.parse(JSON.stringify(workoutData));
            localStorage.setItem(`history_${currentStaff.id}`, JSON.stringify(history));
            renderHistory(); alert("Salvo!");
        }

        window.onload = init;
    </script>
</body>
</html>
